var t=require("@swup/plugin"),e=require("swup");function r(t){return t&&"object"==typeof t&&"default"in t?t:{default:t}}var s=/*#__PURE__*/r(t);module.exports=class extends s.default{constructor(t={}){super(),this.name="SwupFormsPlugin",this.requires={swup:">=4"},this.defaults={formSelector:"form[data-swup-form]",inlineFormSelector:"form[data-swup-inline-form]",stripEmptyParams:!1},this.options=void 0,this.specialKeys={Meta:!1,Control:!1,Shift:!1},this.formSubmitDelegate=void 0,this.onBlur=()=>{this.resetSpecialKeys()},this.onKeyDown=t=>{this.specialKeys.hasOwnProperty(t.key)&&(this.specialKeys[t.key]=!0)},this.onKeyUp=t=>{this.specialKeys.hasOwnProperty(t.key)&&(this.specialKeys[t.key]=!1)},this.handleInlineForms=t=>{const{el:e}=t.trigger;if(!e?.matches(this.options.inlineFormSelector))return;if(!e.id)return void console.error("[@swup/forms-plugin] inline forms must have an id attribute:",e);const r=`#${e.id}`;t.containers=[r],t.animation.scope="containers",t.animation.selector=r,t.scroll.target=r;const s=t.a11y;"object"==typeof s&&(s.focus=r)},this.options={...this.defaults,...t}}mount(){this.swup.hooks.create("form:submit"),this.swup.hooks.create("form:submit:newtab"),this.formSubmitDelegate=this.swup.delegateEvent(this.options.formSelector,"submit",this.beforeFormSubmit.bind(this),{capture:!0}),this.on("visit:start",this.handleInlineForms,{priority:1}),document.addEventListener("keydown",this.onKeyDown),document.addEventListener("keyup",this.onKeyUp),window.addEventListener("blur",this.onBlur)}unmount(){this.formSubmitDelegate?.destroy(),document.removeEventListener("keydown",this.onKeyDown),document.removeEventListener("keyup",this.onKeyUp),window.removeEventListener("blur",this.onBlur)}beforeFormSubmit(t){const r=this.swup,{delegateTarget:s,submitter:o}=t,i=this.getFormAttr("action",s,o)||e.getCurrentUrl(),n=this.isSpecialKeyPressed(),a="_blank"===this.getFormAttr("target",s,o),m=n||a,{url:u,hash:l}=e.Location.fromUrl(i),h=r.createVisit({to:u,hash:l,el:s,event:t});if(m||!r.shouldIgnoreVisit(i,{el:s,event:t})){if(!a)return n?(r.hooks.callSync("form:submit:newtab",h,{el:s,event:t}),s.dataset.swupOriginalFormTarget=s.getAttribute("target")||"",s.setAttribute("target","_blank"),void s.addEventListener("submit",()=>requestAnimationFrame(()=>this.restorePreviousFormTarget(s)),{once:!0})):void r.hooks.callSync("form:submit",h,{el:s,event:t},()=>{this.submitForm(t)});r.hooks.callSync("form:submit:newtab",h,{el:s,event:t})}}restorePreviousFormTarget(t){t.dataset.swupOriginalFormTarget?t.setAttribute("target",t.dataset.swupOriginalFormTarget):t.removeAttribute("target")}submitForm(t){const e=t.delegateTarget,{url:r,hash:s,method:o,data:i,body:n}=this.getFormInfo(e,t);let a=r,m={method:o};switch(o){case"POST":m={method:o,body:n};break;case"GET":this.maybeStripEmptyParams(i),a=this.appendQueryParams(a,i);break;default:return void console.warn(`Unsupported form method: ${o}`)}t.preventDefault(),this.swup.cache.delete(a),this.swup.navigate(a+s,m,{el:e,event:t})}getFormInfo(t,{submitter:r}){const s=(this.getFormAttr("method",t,r)||"get").toUpperCase(),o=this.getFormAttr("action",t,r)||e.getCurrentUrl(),{url:i,hash:n}=e.Location.fromUrl(o),a=(this.getFormAttr("enctype",t,r)||"application/x-www-form-urlencoded").toLowerCase(),m="multipart/form-data"===a,u=new FormData(t);let l;return l=m?u:new URLSearchParams(u),{url:i,hash:n,method:s,data:u,body:l,encoding:a}}getFormAttr(t,e,r=null){return r?.getAttribute(`form${t}`)??e.getAttribute(t)}appendQueryParams(t,e){const r=t.split("?")[0],s=new URLSearchParams(e).toString();return s?`${r}?${s}`:r}maybeStripEmptyParams(t){if(this.options.stripEmptyParams)for(const[e,r]of Array.from(t.entries()))""===r&&t.delete(e)}isSpecialKeyPressed(){return Object.values(this.specialKeys).some(t=>t)}resetSpecialKeys(){for(const t of Object.keys(this.specialKeys))this.specialKeys[t]=!1}};
//# sourceMappingURL=index.cjs.map
