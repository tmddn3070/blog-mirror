!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?module.exports=e():"function"==typeof define&&define.amd?define(e):(t||self).SwupFormsPlugin=e()}(this,function(){function t(){return t=Object.assign?Object.assign.bind():function(t){for(var e=1;e<arguments.length;e++){var r=arguments[e];for(var s in r)Object.prototype.hasOwnProperty.call(r,s)&&(t[s]=r[s])}return t},t.apply(this,arguments)}const e=t=>String(t).split(".").map(t=>String(parseInt(t||"0",10))).concat(["0","0"]).slice(0,3).join(".");class r{constructor(){this.isSwupPlugin=!0,this.swup=void 0,this.version=void 0,this.requires={},this.handlersToUnregister=[]}mount(){}unmount(){this.handlersToUnregister.forEach(t=>t()),this.handlersToUnregister=[]}_beforeMount(){if(!this.name)throw new Error("You must define a name of plugin when creating a class.")}_afterUnmount(){}_checkRequirements(){return"object"!=typeof this.requires||Object.entries(this.requires).forEach(([t,r])=>{if(!function(t,r,s){const o=function(t,e){var r;if("swup"===t)return null!=(r=e.version)?r:"";{var s;const r=e.findPlugin(t);return null!=(s=null==r?void 0:r.version)?s:""}}(t,s);return!!o&&((t,r)=>r.every(r=>{const[,s,o]=r.match(/^([\D]+)?(.*)$/)||[];var i,n;return((t,e)=>{const r={"":t=>0===t,">":t=>t>0,">=":t=>t>=0,"<":t=>t<0,"<=":t=>t<=0};return(r[e]||r[""])(t)})((n=o,i=e(i=t),n=e(n),i.localeCompare(n,void 0,{numeric:!0})),s||">=")}))(o,r)}(t,r=Array.isArray(r)?r:[r],this.swup)){const e=`${t} ${r.join(", ")}`;throw new Error(`Plugin version mismatch: ${this.name} requires ${e}`)}}),!0}on(t,e,r={}){var s;e=!(s=e).name.startsWith("bound ")||s.hasOwnProperty("prototype")?e.bind(this):e;const o=this.swup.hooks.on(t,e,r);return this.handlersToUnregister.push(o),o}once(e,r,s={}){return this.on(e,r,t({},s,{once:!0}))}before(e,r,s={}){return this.on(e,r,t({},s,{before:!0}))}replace(e,r,s={}){return this.on(e,r,t({},s,{replace:!0}))}off(t,e){return this.swup.hooks.off(t,e)}}const s=({hash:t}={})=>window.location.pathname+window.location.search+(t?window.location.hash:"");class o extends URL{constructor(t,e=document.baseURI){super(t.toString(),e),Object.setPrototypeOf(this,o.prototype)}get url(){return this.pathname+this.search}static fromElement(t){const e=t.getAttribute("href")||t.getAttribute("xlink:href")||"";return new o(e)}static fromUrl(t){return new o(t)}}return class extends r{constructor(t){void 0===t&&(t={}),super(),this.name="SwupFormsPlugin",this.requires={swup:">=4"},this.defaults={formSelector:"form[data-swup-form]",inlineFormSelector:"form[data-swup-inline-form]",stripEmptyParams:!1},this.options=void 0,this.specialKeys={Meta:!1,Control:!1,Shift:!1},this.formSubmitDelegate=void 0,this.onBlur=()=>{this.resetSpecialKeys()},this.onKeyDown=t=>{this.specialKeys.hasOwnProperty(t.key)&&(this.specialKeys[t.key]=!0)},this.onKeyUp=t=>{this.specialKeys.hasOwnProperty(t.key)&&(this.specialKeys[t.key]=!1)},this.handleInlineForms=t=>{const{el:e}=t.trigger;if(!e?.matches(this.options.inlineFormSelector))return;if(!e.id)return void console.error("[@swup/forms-plugin] inline forms must have an id attribute:",e);const r=`#${e.id}`;t.containers=[r],t.animation.scope="containers",t.animation.selector=r,t.scroll.target=r;const s=t.a11y;"object"==typeof s&&(s.focus=r)},this.options={...this.defaults,...t}}mount(){this.swup.hooks.create("form:submit"),this.swup.hooks.create("form:submit:newtab"),this.formSubmitDelegate=this.swup.delegateEvent(this.options.formSelector,"submit",this.beforeFormSubmit.bind(this),{capture:!0}),this.on("visit:start",this.handleInlineForms,{priority:1}),document.addEventListener("keydown",this.onKeyDown),document.addEventListener("keyup",this.onKeyUp),window.addEventListener("blur",this.onBlur)}unmount(){this.formSubmitDelegate?.destroy(),document.removeEventListener("keydown",this.onKeyDown),document.removeEventListener("keyup",this.onKeyUp),window.removeEventListener("blur",this.onBlur)}beforeFormSubmit(t){const e=this.swup,{delegateTarget:r,submitter:i}=t,n=this.getFormAttr("action",r,i)||s(),a=this.isSpecialKeyPressed(),u="_blank"===this.getFormAttr("target",r,i),h=a||u,{url:l,hash:m}=o.fromUrl(n),c=e.createVisit({to:l,hash:m,el:r,event:t});if(h||!e.shouldIgnoreVisit(n,{el:r,event:t})){if(!u)return a?(e.hooks.callSync("form:submit:newtab",c,{el:r,event:t}),r.dataset.swupOriginalFormTarget=r.getAttribute("target")||"",r.setAttribute("target","_blank"),void r.addEventListener("submit",()=>requestAnimationFrame(()=>this.restorePreviousFormTarget(r)),{once:!0})):void e.hooks.callSync("form:submit",c,{el:r,event:t},()=>{this.submitForm(t)});e.hooks.callSync("form:submit:newtab",c,{el:r,event:t})}}restorePreviousFormTarget(t){t.dataset.swupOriginalFormTarget?t.setAttribute("target",t.dataset.swupOriginalFormTarget):t.removeAttribute("target")}submitForm(t){const e=t.delegateTarget,{url:r,hash:s,method:o,data:i,body:n}=this.getFormInfo(e,t);let a=r,u={method:o};switch(o){case"POST":u={method:o,body:n};break;case"GET":this.maybeStripEmptyParams(i),a=this.appendQueryParams(a,i);break;default:return void console.warn(`Unsupported form method: ${o}`)}t.preventDefault(),this.swup.cache.delete(a),this.swup.navigate(a+s,u,{el:e,event:t})}getFormInfo(t,e){let{submitter:r}=e;const i=(this.getFormAttr("method",t,r)||"get").toUpperCase(),n=this.getFormAttr("action",t,r)||s(),{url:a,hash:u}=o.fromUrl(n),h=(this.getFormAttr("enctype",t,r)||"application/x-www-form-urlencoded").toLowerCase(),l="multipart/form-data"===h,m=new FormData(t);let c;return c=l?m:new URLSearchParams(m),{url:a,hash:u,method:i,data:m,body:c,encoding:h}}getFormAttr(t,e,r){return void 0===r&&(r=null),r?.getAttribute(`form${t}`)??e.getAttribute(t)}appendQueryParams(t,e){const r=t.split("?")[0],s=new URLSearchParams(e).toString();return s?`${r}?${s}`:r}maybeStripEmptyParams(t){if(this.options.stripEmptyParams)for(const[e,r]of Array.from(t.entries()))""===r&&t.delete(e)}isSpecialKeyPressed(){return Object.values(this.specialKeys).some(t=>t)}resetSpecialKeys(){for(const t of Object.keys(this.specialKeys))this.specialKeys[t]=!1}}});
//# sourceMappingURL=index.umd.js.map
